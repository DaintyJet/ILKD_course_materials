## Lecture 08: Wednesday, 26 June 2024


What ways can your program crash? Has anyone written a C program that crashed? what happened?

Crash type iceberg:
 - SIGSEGV
 - SIGFPE
 - SIGBUS
 - SIGILL

try and write some assembly code that executes illegal or privileged instructions. What happens?

What mechanism underlies this

traps exceptions interrupts aborts

<https://github.com/underground-software/kernel-stash/blob/master/KDLP/kernel_basics.md>
1. How does the kernel know a program is doing something illegal?
  1. Control flow for hardware exceptions
  1. Follow message from dmesg to hardware
  1. Other kinds of exceptions
    1. Traps: intentionally switch to kernel mode to run code but can return to where we left off
    1. Faults: go into kernel mode as side effect, e.g. page fault (normal and excepted if not in working set)
    1. Aborts: generally unrecoverable errors, double & triple faults or machine errors, OS bugs
  1. Exceptions are a type of interrupt, along with:
    1. hardware interrupts (IRQs: Interrupts Requests)
    1. software interrupts (IPIs: Inter-process interrupts)

https://github.com/underground-software/kernel-stash/blob/master/KDLP/kernel_basics.md

1. Processes (35m)
  1. PID, TGID kernel vs userspace lingo
  1. parent/child relationships
  1. PID 1, subreapers (`prctl(PR_SET_CHILD_SUBREAPER)`), and orphans
  1. PID namespaces, unshare, containers
1. file descriptors & syscalls (35m)
  1. what is a file descriptor
  1. usage in syscalls
  1. everything is a file (descriptor)
  1. fopen vs open: beyond the libc
  1. signals: SIGCHLD, SIGPIPE

What is a file descriptor?
 - references open file on disk (could refer to a directory or a symlink too)
 - even unix had seeds of something else (block and char devices, sockets and fifos)
 - the real answer is a handle to some sort of kernel resource
What is a signal?
 - naive answer is asynchronous notification that calls a function
 - really just an upcall from kernel space to userspace
 - actually not nessecarily a function call, or asynchronous (signalfd)
What is a syscall?
 - naive answer is magic function call that invokes the kernel
 - could write a program that invokes no syscalls, but its results would not be obvservable (caveat, maybe?)
 - really it is the atom of observable computing
 - not even really a function call (io_uring)
What is a process, what is a thread?
 - naive answer is fork and pthread create,
 - in reality they are points within a multidimensional space governed by unshare


Live instrumentation with GDB?
